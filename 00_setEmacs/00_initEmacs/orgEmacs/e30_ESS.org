* e30_ess.org
#+BEGIN_SRC emacs-lisp
  (require 'ess-site)  ;; Load ESS from ELPA to Highlight R and Auto-complte
  (setq ess-eval-visibly nil) ; t ESS will not print the evaluated comands, also speeds up the evaluation
  ;; This causes commands to be invisible, and leaves junk like + + + > > >;
  (setq ess-ask-for-ess-directory nil) ;; Dont ask each time when start an interactive R session  C-c C-s

#+END_SRC

    (ess-toggle-underscore nil)
    ;; C-c r を押した際に表示される候補数の上限値
    ;; 表示数が多いと処理が重くなる
    (setq anything-R-help-limit 40)
    (setq anything-R-local-limit 20)
    ;; C-c r で R の関数やオブジェクトを検索できるようにする
    (when (require 'anything-R nil t)
      ;; ess-smart-comma が導入されたので repospkg と localpkg はあまり必要なさそう
      (setq anything-for-R-list '(anything-c-source-R-help
                                  anything-c-source-R-local))
      (define-key ess-mode-map (kbd "C-c r") 'anything-for-R)
      (define-key inferior-ess-mode-map (kbd "C-c r") 'anything-for-R))
    ;; C-c C-g で オブジェクトの内容を確認できるようにする
    (require 'ess-R-object-popup nil t)
    ;; 補完機能を有効にする
    (setq ess-use-auto-complete t)
    ;; anything を使いたいので IDO は邪魔
    (setq ess-use-ido nil)
    ;; キャレットがシンボル上にある場合にもエコーエリアにヘルプを表示する
   
  

 


** iESS Mode: ESS-comint Mode
Auto-scrolling of R console to bottom and Shift key extension
#+BEGIN_SRC emacs-lisp
(setq ansi-color-for-comint-mode 'filter)
(setq comint-prompt-read-only t)
(setq comint-scroll-to-bottom-on-input t)
(setq comint-scroll-to-bottom-on-output t)
(setq comint-move-point-for-output t)
#+END_SRC
** ESS Auto complete:: DEFAULT > 12.09
#+BEGIN_SRC emacs-lisp
(setq ess-use-auto-complete t)
(ess-force-buffer-current "Process to load into: ")))
#+END_SRC
** ESS Code indentation 
;; http://ess.r-project.org/Manual/ess.html#Indenting
;; https://svn.r-project.org/ESS/trunk/lisp/ess-custom.el
;; ESS provides: DEFAULT, OWN, GNU, BSD, K&R, C++, RRR, CLB.
;;                                 DEF GNU BSD K&R C++ RRR CLB
;; ess-indent-level                  2   2   8   5   4   4   2
;; ess-continued-statement-offset    2   2   8   5   4   4   4
;; ess-brace-offset                  0   0  -8  -5  -4   0   0
;; ess-arg-function-offset           2   4   0   0   0   4   0
;; ess-expression-offset             4   2   8   5   4   4   4
;; ess-else-offset                   0   0   0   0   0   0   0
;; ess-close-brace-offset            0   0   0   0   0   0   2
;;(setq ess-default-style 'C++) ; Vincent's recommendation
#+BEGIN_SRC emacs-lisp
(setq ess-default-style 'BSD)   ; Common R chosen
#+END_SRC

** Ess eldoc
#+BEGIN_SRC emacs-lisp
(require 'ess-eldoc)
(setq ess-eldoc-show-on-symbol t)
#+END_SRC

** ESS Code fold
In order to enable Emacs’ standard OutlineMode for .R files:
#+BEGIN_SRC emacs-lisp
  (add-hook 'ess-mode-hook
          '(lambda ()
             (outline-minor-mode)
             (setq outline-regexp "\\(^#\\{4,5\\} \\)\\|\\(^[a-zA-Z0-9_\.]+ ?<-?function(.*{\\)")
             (defun outline-level ()
               (cond ((looking-at "^##### ") 1)
                 ((looking-at "^#### ") 2)
                 ((looking-at "^[a-zA-Z0-9_\.]+ ?<- ?function(.*{") 3)
                 (t 1000)))
             ))
  (add-hook 'ess-mode-hook
            '(lambda() (yafolding-mode)))
#+END_SRC

** ESS Tracebug: A debugger for your code
#+BEGIN_SRC emacs-lisp
(require 'ess-tracebug)    ;; http://code.google.com/p/ess-tracebug/
(setq ess-use-tracebug t)                    ; permanent activation
; ;(setq ess-tracebug-prefix "\M-t")               ; activate with M-t
(add-hook 'ess-post-run-hook 'ess-tracebug t)
#+END_SRC
** ESS Underscore  preservation
;; http://www.r-bloggers.com/a-small-customization-of-ess/
(ess-toggle-underscore nil) ;; leave my underscore key alone!
#+BEGIN_SRC emacs-lisp
(require 'ess-smart-underscore)  ;;elpa
(setq ess-S-assign-key (kbd "C-="))
(ess-toggle-S-assign-key t)     ; enable above key definition
#+END_SRC
** ESS Key-Bindings
#+BEGIN_SRC emacs-lisp
  ;; ESS Mode (.R file)
    (define-key ess-mode-map "\C-l" 'ess-eval-line-and-step)
    (define-key ess-mode-map "\C-p" 'ess-eval-function-or-paragraph-and-step)
    (define-key ess-mode-map "\C-r" 'ess-eval-region)

  ;; iESS Mode (R console)
    (define-key inferior-ess-mode-map "\C-u" 'comint-kill-input)
    (define-key inferior-ess-mode-map "\C-w" 'backward-kill-word)
    (define-key inferior-ess-mode-map "\C-a" 'comint-bol)
    (define-key inferior-ess-mode-map [home] 'comint-bol)

  ;; Comint Mode (R console as well)
    (define-key comint-mode-map "\C-e" 'comint-show-maximum-output)
    (define-key comint-mode-map "\C-r" 'comint-show-output)
    (define-key comint-mode-map "\C-o" 'comint-kill-output)

  ;;Tracing bug
    (define-key ess-mode-map "\M-]" 'next-error)
    (define-key ess-mode-map "\M-[" 'previous-error)
    (define-key inferior-ess-mode-map "\M-]" 'next-error-no-select)
    (define-key inferior-ess-mode-map "\M-[" 'previous-error-no-select)
    (define-key compilation-minor-mode-map [(?n)] 'next-error-no-select)
    (define-key compilation-minor-mode-map [(?p)] 'previous-error-no-select)
#+END_SRC
** ESS Font-lock
#+BEGIN_SRC emacs-lisp
  (custom-set-variables
   ;; custom-set-variables was added by Custom.
   ;; If you edit it by hand, you could mess it up, so be careful.
   ;; Your init file should contain only one such instance.
   ;; If there is more than one, they won't work right.
   '(ess-R-font-lock-keywords (quote ((ess-R-fl-keyword:modifiers . t)
                                      (ess-R-fl-keyword:fun-defs . t)
                                      (ess-R-fl-keyword:keywords . t)
                                      (ess-R-fl-keyword:assign-ops . t)
                                      (ess-R-fl-keyword:constants . t)
                                      (ess-fl-keyword:fun-calls . t)
                                      (ess-fl-keyword:numbers . t)
                                      (ess-fl-keyword:operators . t)
                                      (ess-fl-keyword:delimiters . t)
                                      (ess-fl-keyword:= . t)
                                      (ess-R-fl-keyword:F&T . t)))))
#+END_SRC
** ESS rdired 
#+BEGIN_SRC emacs-lisp
(autoload 'ess-rdired "ess-rdired" 
  "View *R* objects in a dired-like buffer." t)
#+END_SRC
** ESS Sweave
#+BEGIN_SRC emacs-lisp
;; Lets you do 'C-c C-c Sweave' from your Rnw file
(defun emacsmate-add-Sweave ()
  (add-to-list 'TeX-command-list
           '("Sweave" "R CMD Sweave %s"
         TeX-run-command nil (latex-mode) :help "Run Sweave") t)
  (add-to-list 'TeX-command-list
           '("LatexSweave" "%l %(mode) %s"
         TeX-run-TeX nil (latex-mode) :help "Run Latex after Sweave") t)
  (setq TeX-command-default "Sweave"))

(add-hook 'Rnw-mode-hook 'emacsmate-add-Sweave)
#+END_SRC

** R Basic
#+BEGIN_SRC emacs-lisp
  (autoload 'R-mode "ess-site" "Emacs Speaks Statistics mode" t)
  (autoload 'R "ess-site" "start R" t)
  (setq-default inferior-R-program-name "R")  ;; Search R in a nonstandard location on Linux
  (setq-default ess-dialect "R")
  (setq-default inferior-R-args "--no-restore-history --no-save ")
  (setq ess-local-process-name "R")
  (defun ess-set-language ()
    (setq-default ess-language "R")
    (setq ess-language "R")
    )
(add-hook 'ess-post-run-hook 'ess-set-language t)
(add-hook 'ess-pre-run-hook (lambda () (ess-load-hook t))) ;; R 起動直前の処理
(add-hook 'R-mode-hook 'ess-load-hook) ;; R-mode 起動直後の処理
#+END_SRC
** DONE R Mode list
#+BEGIN_SRC emacs-lisp
  ;;(setq auto-mode-alist
   ;;     (cons (cons "\\.r$|\\.R$" 'R-mode) auto-mode-alist))

  (add-to-list 'auto-mode-alist '("\\.[rR]$" . R-mode))
  ;; *.r.txt and *.R.txt files activate r-mode            ; Obsolete. Just set TextEdit.app for .R in Finder
  ;; Maybe useful for result files, open with ESS (emacs) or TextEdit.app (GUI) automatically
  (setq auto-mode-alist
        (cons '("\\.r\\.txt$" . R-mode) auto-mode-alist))
  (setq auto-mode-alist
        (cons '("\\.R\\.txt$" . R-mode) auto-mode-alist))
  (setq auto-mode-alist
        (cons '("\\.RRR$" . R-mode) auto-mode-alist))


#+END_SRC
** DONE R Data Summary ess-R-object-popup  R-object-tooltip to show summary
#+BEGIN_SRC emacs-lisp
  (require 'ess-R-object-popup)
  (define-key ess-mode-map (kbd "C-c s") 'ess-R-object-popup)
  ;; the alist
  (setq ess-R-object-popup-alist
        '((numeric    . "summary")
          (factor     . "table")
          (integer    . "summary")
          (lm         . "summary")
          (other      . "str")))
  
#+END_SRC
** DONE R Data view  C-c v, C-c V
#+BEGIN_SRC emacs-lisp
(define-key ess-mode-map (kbd "C-c V") 'ess-R-dv-ctable)
(define-key ess-mode-map (kbd "C-c v") 'ess-R-dv-pprint)
#+END_SRC
** DONE R Auto Complete Source
#+BEGIN_SRC emacs-lisp
(require 'ac-R)
(require 'helm-R)
#+END_SRC
** TODO inlineR
#+BEGIN_SRC emacs-lisp
  ;; (require 'inlineR)
  ;; (setq inlineR-re-funcname "plot\|image\|hogehoge\|my-func")
  ;; (setq inlineR-default-image "png")
  ;; (setq inlineR-default-dir "/tmp/")
  ;; (setq inlineR-cairo-p t)
#+END_SRC
** Window
#+BEGIN_SRC emacs-lisp
;; ウィンドウが1つの状態で *.R を開いた場合はウィンドウを縦に分割して R を表示する
(when (one-window-p)
        (split-window-horizontally)
        (let ((buf (current-buffer)))
          (ess-switch-to-ESS nil)
          (switch-to-buffer-other-window buf)))
  (if from-iess-p
      ;; R のプロセスが他になければウィンドウを分割する
      (if (> (length ess-process-name-list) 0)
          (when (one-window-p)
            (split-window-horizontally)
            (other-window 1)))
#+END_SRC
